<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Calculator</title>
    <style>
        /*
        ========================================
        CSS Styling
        ========================================
        */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
        }

        .calculator {
            width: 350px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            background-color: #fff;
            padding: 10px;
        }

        /* Tabs Styling */
        .tabs {
            display: flex;
            margin-bottom: 10px;
        }

        .tab-button {
            padding: 5px 15px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-bottom: none;
            border-top-left-radius: 8px; 
            border-top-right-radius: 8px;
            background-color: #f9f9f9;
            color: #333;
            font-weight: bold;
            transition: all 0.3s ease; 
        }

        .tab-button.active {
            background-color: #3d688a; 
            color: white;
            border-color: #3d688a;
        }
        
        .display {
            background-color: #eee;
            border-radius: 4px;
            padding: 5px;
            margin-bottom: 10px;
            text-align: right;
            user-select: none;
        }

        .history {
            height: 20px;
            color: #666;
            font-size: 0.8em;
            padding: 0 5px;
        }

        .result {
            font-size: 2em;
            height: 40px;
            padding: 0 5px;
            color: #3d688a;
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        /* Button Styling: Pill shape and click animation */
        .button {
            padding: 15px 0;
            border: none;
            border-radius: 12px; 
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s ease-out; 
            background-color: #f5f5f5;
            color: #333;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Hover and Active (Click) effects */
        .button:hover {
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .button:active {
            background-color: #ccc;
            transform: scale(0.95); 
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        /* Operation and special function colors */
        .operation-button, .function-button, .operator, .side-action-button {
            background-color: #d8e5f1;
            color: #3d688a;
        }
        
        .clear-button {
            background-color: #f3c2c2;
            color: #d9534f;
            font-weight: bold;
        }

        /* Scientific Section Layout */
        .scientific-section {
            grid-column: span 5;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }

        .scientific-section .button {
            padding: 10px 0;
            font-size: 0.9em;
            background-color: #d8e5f1;
            color: #3d688a;
        }
        
        /* Unified Deg/Rad Toggle Button */
        #mode-toggle-button {
            grid-column: span 2; 
            font-weight: bold;
            background-color: #c9e0f3; 
        }

        /* Hide scientific buttons when Basic tab is active */
        .basic-mode .scientific-section {
             display: none;
        }
    </style>
</head>
<body class="scientific-mode">

<div class="calculator" id="calculator">
    
    <div class="tabs">
        <div class="tab-button" id="basic-tab">Basic</div>
        <div class="tab-button active" id="scientific-tab">Scientific</div>
    </div>
    
    <div class="display">
        <div class="history" id="history-display">0</div>
        <div class="result" id="result-display">0</div>
    </div>
    
    <div class="buttons-grid">
        
        <div class="scientific-section" id="scientific-buttons">
            <button class="button function-button" data-value="sin(">sin</button>
            <button class="button function-button" data-value="cos(">cos</button>
            <button class="button function-button" data-value="tan(">tan</button>
            
            <button class="button function-button" id="mode-toggle-button" data-action="toggle-mode">Deg</button>
            
            <button class="button function-button" data-value="&pi;">&pi;</button>
            <button class="button function-button" data-value="e">e</button>

            <button class="button function-button" data-value="asin(">sin⁻¹</button>
            <button class="button function-button" data-value="acos(">cos⁻¹</button>
            <button class="button function-button" data-value="atan(">tan⁻¹</button>
            
            <button class="button function-button" data-value="^" data-action="prefix-function" data-prefix="^Y">xʸ</button>
            <button class="button function-button" data-value="^2" data-action="prefix-function" data-prefix="^2">x²</button>
            <button class="button function-button" data-value="^3" data-action="prefix-function" data-prefix="^3">x³</button>
            
            <button class="button function-button" data-value="yroot" data-action="prefix-function" data-prefix="Y√">ʸ√x</button>
            <button class="button function-button" data-value="cbrt" data-action="prefix-function" data-prefix="3√">³√x</button>
            <button class="button function-button" data-value="√" data-action="prefix-function" data-prefix="√">√x</button>
            
            <button class="button function-button" data-value="ln(">ln</button>
            <button class="button function-button" data-value="log10(">log</button>
            <button class="button function-button" data-value="10^(" data-prefix="10^">10ˣ</button>

            <button class="button operator" data-value="(">(</button>
            <button class="button operator" data-value=")">)</button>
            <button class="button function-button" data-value="1/(" data-prefix="1/">1/x</button>
            <button class="button operator" data-value="%">%</button>
            <button class="button function-button" data-value="fact(">n!</button>
        </div>
        
        <button class="button" data-value="7">7</button>
        <button class="button" data-value="8">8</button>
        <button class="button" data-value="9">9</button>
        <button class="button operator" data-value="+">+</button>
        <button class="button side-action-button" data-action="back">Back</button>

        <button class="button" data-value="4">4</button>
        <button class="button" data-value="5">5</button>
        <button class="button" data-value="6">6</button>
        <button class="button operator" data-value="-">-</button>
        <button class="button side-action-button" data-value="Ans" data-action="Ans">Ans</button>

        <button class="button" data-value="1">1</button>
        <button class="button" data-value="2">2</button>
        <button class="button" data-value="3">3</button>
        <button class="button operator" data-value="*">×</button>
        <button class="button side-action-button" data-action="M+">M+</button>

        <button class="button" data-value="0">0</button>
        <button class="button" data-value=".">.</button>
        <button class="button function-button" data-value="E">EXP</button>
        <button class="button operator" data-value="/">/</button>
        <button class="button side-action-button" data-action="M-">M-</button>

        <button class="button operator" data-action="plusminus">±</button>
        <button class="button function-button" data-action="RND">RND</button>
        <button class="button clear-button" data-action="ac">AC</button>
        <button class="button operation-button" data-action="=">=</button>
        <button class="button side-action-button" data-action="MR">MR</button>
    </div>
</div>

<script>
    /*
    ========================================
    JavaScript Logic
    ========================================
    */
    const calculator = document.getElementById('calculator');
    const resultDisplay = document.getElementById('result-display');
    const historyDisplay = document.getElementById('history-display');
    const basicTab = document.getElementById('basic-tab');
    const scientificTab = document.getElementById('scientific-tab');
    const buttonsGrid = document.querySelector('.buttons-grid');
    const modeToggleButton = document.getElementById('mode-toggle-button'); 
    
    let currentExpression = '';
    let lastResult = '0';
    let memory = 0;
    let mode = 'deg'; 

    resultDisplay.textContent = lastResult;
    historyDisplay.textContent = '';
    
    // ==================
    // Utility Functions for Scientific Operations
    // ==================
    
    const toRad = (angle) => (mode === 'deg' ? angle * (Math.PI / 180) : angle);
    const factorial = (n) => (n < 0 ? NaN : n === 0 ? 1 : n * factorial(n - 1));
    // Note: nthRoot(y, x) calculates the y-th root of x (index Y, base X)
    const nthRoot = (y, x) => Math.pow(x, 1 / y);

    /**
     * Finds the last numerical part (number or parenthesized expression or function) 
     * in the current expression.
     */
    const findLastNumericPart = (exp) => {
        // 1. Check for last number or constant (pi/e/Ans)
        const numberOrConstant = /(\d+\.?\d*|&pi;|e|Ans)$/;
        let match = exp.match(numberOrConstant);

        if (match) {
            return {
                lastPart: match[0],
                rest: exp.slice(0, exp.length - match[0].length)
            };
        }
        
        // 2. Check for last parenthesized expression or function call
        let lastCloseParenIndex = exp.lastIndexOf(')');
        if (lastCloseParenIndex !== -1) {
            let openParenCount = 0;
            for (let i = exp.length - 1; i >= 0; i--) {
                if (exp[i] === ')') openParenCount++;
                if (exp[i] === '(') openParenCount--;
                
                if (openParenCount === 0 && i !== lastCloseParenIndex) {
                    const lastPart = exp.slice(i, exp.length);
                    
                    // Check if it's a function call (e.g., sin(...)) 
                    const functionMatch = exp.slice(0, i).match(/[a-z0-9]*$/i);
                    const functionName = functionMatch ? functionMatch[0] : '';
                    
                    const fullLastPart = functionName + lastPart;
                    
                    return {
                        lastPart: fullLastPart,
                        rest: exp.slice(0, i - functionName.length)
                    };
                }
            }
        }

        return { lastPart: '', rest: exp };
    };


    /**
     * Converts the current expression (using symbols like ^ and √) into an evaluable JavaScript expression.
     */
    const prepareExpression = (expression) => {
        let prep = expression;
        
        // --- 1. Replace constants ---
        prep = prep.replace(/&pi;/g, 'Math.PI');
        prep = prep.replace(/e/g, 'Math.E');
        
        // --- 2. Replace functions using symbols (Roots and Powers) ---
        
        // This pattern matches any number, constant, or parenthesized expression
        const basePattern = '(\\d+(\\.\\d*)*|&pi;|e|Ans|\\([^)]+\\))';

        // a. Square Root (√X)
        // Matches √ and then a number/constant/paren expression
        prep = prep.replace(new RegExp(`√${basePattern}`, 'g'), 'Math.sqrt($1)');

        // b. N-th Root (^Y√X) -> nthRoot(Y, X)
        // Matches (index)√ (base)
        // This is complex, so we match index (number/constant/paren) followed by √ and then base
        // Note: The index Y must be the first captured group ($1) and the base X is the second ($4)
        const nRootPattern = new RegExp(`${basePattern}√${basePattern}`, 'g');
        prep = prep.replace(nRootPattern, 'nthRoot($1, $4)');
        
        // c. Power (X^Y) -> Math.pow(X, Y)
        // Matches (base)^(exponent)
        const powerPattern = new RegExp(`${basePattern}\\^${basePattern}`, 'g');
        prep = prep.replace(powerPattern, 'Math.pow($1, $4)');


        // --- 3. Replace standard prefix functions ---

        // Handle factorial (n!)
         prep = prep.replace(/fact\(([^)]+)\)/g, (match, p1) => {
             try {
                 const num = parseFloat(eval(prepareExpression(p1)));
                 return factorial(num);
             } catch {
                 return 'NaN';
             }
         });
        
        // Trigonometric functions (with angle conversion)
        prep = prep.replace(/sin\(([^)]+)\)/g, 'Math.sin(toRad($1))');
        prep = prep.replace(/cos\(([^)]+)\)/g, 'Math.cos(toRad($1))');
        prep = prep.replace(/tan\(([^)]+)\)/g, 'Math.tan(toRad($1))');
        
        // Inverse trigonometric functions 
        const radToCurrentMode = (val) => mode === 'deg' ? `(${val} * (180 / Math.PI))` : val;

        prep = prep.replace(/asin\(([^)]+)\)/g, `(${radToCurrentMode('Math.asin($1)')})`);
        prep = prep.replace(/acos\(([^)]+)\)/g, `(${radToCurrentMode('Math.acos($1)')})`);
        prep = prep.replace(/atan\(([^)]+)\)/g, `(${radToCurrentMode('Math.atan($1)')})`);

        // Logarithmic functions
        prep = prep.replace(/ln\(([^)]+)\)/g, 'Math.log($1)');
        prep = prep.replace(/log10\(([^)]+)\)/g, 'Math.log10($1)');
        
        // 10^x
        prep = prep.replace(/10\^\(([^)]+)\)/g, 'Math.pow(10, $1)');

        // 1/x
        prep = prep.replace(/1\/\(([^)]+)\)/g, '1/($1)');
        
        // Exponential notation (EXP)
        prep = prep.replace(/E/g, '*10**');
        
        // Replace 'Ans' with last result
        prep = prep.replace(/Ans/g, `(${lastResult})`); 
        
        // Handle percentage (%) as simple division
        prep = prep.replace(/(\d+(\.\d+)?)%/g, '($1 / 100)');
        
        // Replace multiplication symbol
        prep = prep.replace(/×/g, '*');
        
        return prep;
    };
    
    // ==================
    // Main Input Handler
    // ==================

    const handleInput = (value, action) => {
        
        // Handle Mode Toggle (Deg/Rad)
        if (action === 'toggle-mode') {
            if (mode === 'deg') {
                mode = 'rad';
                modeToggleButton.textContent = 'Rad';
                historyDisplay.textContent = 'Mode: RAD';
            } else {
                mode = 'deg';
                modeToggleButton.textContent = 'Deg';
                historyDisplay.textContent = 'Mode: DEG';
            }
            return; 
        }

        // Handle Prefix Functions (x^2, x^y, y√x, √x)
        if (action === 'prefix-function') {
            const button = document.querySelector(`[data-action="prefix-function"][data-value="${value}"]`);
            const prefix = button.dataset.prefix;

            const { lastPart, rest } = findLastNumericPart(currentExpression);
            
            if (lastPart) {
                let newExpression;
                
                if (value === '^') {
                    // X^Y -> lastPart^
                    newExpression = rest + lastPart + value;
                } else if (value === '^2' || value === '^3') {
                    // X^N -> lastPart^N
                    newExpression = rest + lastPart + value;
                } else if (value === 'yroot') {
                    // Y√X (index is next input) -> lastPart + √
                    newExpression = rest + lastPart + '√';
                } else if (value === 'cbrt') {
                    // 3√X -> 3√lastPart (needs an opener for root base)
                    newExpression = rest + '3√' + lastPart;
                } else if (value === '√') {
                    // √X -> √lastPart
                    newExpression = rest + value + lastPart;
                } else {
                    newExpression = currentExpression + prefix;
                }

                currentExpression = newExpression;
                resultDisplay.textContent = currentExpression;
            } else {
                 // If no number/expression precedes, add a placeholder
                 if (value === '^') {
                     currentExpression += '0^'; 
                 } else if (value === 'yroot') {
                    // The index Y must be entered first
                    currentExpression += '1√'; 
                 } else if (value === 'cbrt') {
                    currentExpression += '3√';
                 } else if (value === '√') {
                    currentExpression += '√';
                 } else {
                    currentExpression += value;
                 }

                resultDisplay.textContent = currentExpression;
            }
            return;
        }

        // Handle Equals
        if (action === '=') {
            try {
                const finalExpression = prepareExpression(currentExpression);
                
                // Add utility function to global scope for eval
                window.nthRoot = nthRoot; 
                
                let result = eval(finalExpression);
                
                if (isNaN(result) || !isFinite(result)) {
                    throw new Error("Math Error");
                }
                
                historyDisplay.textContent = currentExpression + ' =';
                // Clean up result for display
                lastResult = result.toFixed(10).replace(/\.?0+$/, ""); 
                resultDisplay.textContent = lastResult;
                currentExpression = lastResult;
            } catch (e) {
                resultDisplay.textContent = 'Error';
                historyDisplay.textContent = '';
                currentExpression = '';
            }
            return;
        }

        // Handle other actions
        switch (action) {
            case 'ac': 
                currentExpression = '';
                resultDisplay.textContent = '0';
                historyDisplay.textContent = '';
                break;

            case 'back': 
                currentExpression = currentExpression.slice(0, -1);
                resultDisplay.textContent = currentExpression || '0';
                historyDisplay.textContent = '';
                break;
                
            case 'M+':
            case 'M-':
                try {
                    const val = parseFloat(eval(prepareExpression(currentExpression || lastResult)));
                    if (action === 'M+') memory += val;
                    else memory -= val;
                    historyDisplay.textContent = `M ${action.slice(1)}: ${val.toFixed(2)}`;
                    currentExpression = ''; 
                    resultDisplay.textContent = lastResult;
                } catch (e) {
                     historyDisplay.textContent = `Error in ${action}`;
                }
                break;

            case 'MR': 
                currentExpression += memory.toString();
                resultDisplay.textContent = currentExpression;
                historyDisplay.textContent = '';
                break;

            case 'plusminus': 
                 if (currentExpression === '' && lastResult !== '0') {
                    currentExpression = `(-${lastResult})`;
                } else {
                    const match = currentExpression.match(/(\d+\.?\d*|[^()]+)$/);
                    if (match) {
                        const lastPart = match[0];
                        const newPart = lastPart.startsWith('(-') 
                            ? lastPart.slice(2, -1) 
                            : `(-${lastPart})`; 
                            
                        currentExpression = currentExpression.slice(0, -lastPart.length) + newPart;
                    } else if (currentExpression === '' || ['+', '-', '*', '/', 'E'].includes(currentExpression.slice(-1))) {
                        currentExpression += '(-';
                    }
                }
                resultDisplay.textContent = currentExpression;
                historyDisplay.textContent = '';
                break;
                
            case 'RND': 
                const randomVal = Math.random().toFixed(10).replace(/\.?0+$/, "");
                currentExpression += randomVal;
                resultDisplay.textContent = currentExpression;
                historyDisplay.textContent = '';
                break;
                
            case 'Ans':
                currentExpression += 'Ans';
                resultDisplay.textContent = currentExpression;
                historyDisplay.textContent = '';
                break;

            default: 
                currentExpression += value;
                resultDisplay.textContent = currentExpression;
                historyDisplay.textContent = '';
                break;
        }
    };
    
    // ==================
    // Event Listeners
    // ==================

    // Button event listener (delegation)
    buttonsGrid.addEventListener('click', (e) => {
        const target = e.target;
        if (target.classList.contains('button') || target.closest('.button')) {
            const button = target.closest('.button');
            const value = button.dataset.value || button.textContent;
            const action = button.dataset.action;

            handleInput(value, action);
        }
    });
    
    // Tab event listeners
    basicTab.addEventListener('click', () => {
        calculator.classList.add('basic-mode');
        scientificTab.classList.remove('active');
        basicTab.classList.add('active');
    });

    scientificTab.addEventListener('click', () => {
        calculator.classList.remove('basic-mode');
        basicTab.classList.remove('active');
        scientificTab.classList.add('active');
    });
    
</script>

</body>
</html>
