<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Information</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}

body{
    font-family:'Cairo',sans-serif;
    background:#e6f4ea;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px;
}

.card{
    background:#fff;
    width:100%;
    max-width:480px;
    padding:26px;
    border-radius:22px;
    border:1px solid #bbf7d0;
}

h1{
    font-family:'Montserrat',sans-serif;
    text-align:center;
    font-size:34px;
    font-weight:800;
    margin-bottom:18px;
    background:linear-gradient(to right,#22c55e,#15803d);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}

.alert{
    background:#fff7ed;
    border:1px solid #fdba74;
    color:#9a3412;
    padding:14px;
    border-radius:12px;
    margin-bottom:14px;
    font-size:14px;
    display:none;
}

.row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:#f0fdf4;
    padding:13px 16px;
    border-radius:12px;
    margin-bottom:10px;
}

.label{
    display:flex;
    align-items:center;
    gap:10px;
    color:#065f46;
    font-size:14px;
}

.value{
    font-weight:700;
    color:#064e3b;
    font-size:14px;
    text-align:right;
    max-width:58%;
    word-break:break-word;
}

.loader{
    text-align:center;
    padding:35px;
}

.spinner{
    width:42px;
    height:42px;
    border:4px solid #bbf7d0;
    border-top-color:#16a34a;
    border-radius:50%;
    animation:spin 1s linear infinite;
    margin:0 auto 12px;
}

@keyframes spin{to{transform:rotate(360deg)}}
.hidden{display:none}
</style>
</head>

<body>

<div class="card">
<h1>User Information</h1>

<div id="loader" class="loader">
    <div class="spinner"></div>
    <p>Detecting GPS locationâ€¦</p>
</div>

<div id="content" class="hidden">

    <div id="alert" class="alert">
        <b>Location mismatch detected</b><br>
        The IP address location does not match the GPS location.
        This may indicate the use of VPN, proxy, or manipulated network routing,
        which can affect the accuracy of displayed information.
    </div>

    <div class="row"><div class="label"><i class="fas fa-network-wired"></i> IP Address</div><div class="value" id="ip"></div></div>
    <div class="row"><div class="label"><i class="fas fa-code"></i> IP Version</div><div class="value" id="ipType"></div></div>

    <div class="row"><div class="label"><i class="fas fa-city"></i> City (GPS)</div><div class="value" id="city"></div></div>
    <div class="row"><div class="label"><i class="fas fa-map"></i> State / Region (GPS)</div><div class="value" id="region"></div></div>
    <div class="row"><div class="label"><i class="fas fa-envelope"></i> Postal Code</div><div class="value" id="postal"></div></div>
    <div class="row"><div class="label"><i class="fas fa-globe"></i> Country (GPS)</div><div class="value" id="country"></div></div>

    <div class="row"><div class="label"><i class="fas fa-wifi"></i> ISP</div><div class="value" id="isp"></div></div>
    <div class="row"><div class="label"><i class="fas fa-server"></i> ASN</div><div class="value" id="asn"></div></div>
    <div class="row"><div class="label"><i class="fas fa-clock"></i> Time Zone</div><div class="value" id="timezone"></div></div>

</div>
</div>

<script>
let ipData = {};
let gpsData = {};

async function loadIP(){
    const r = await fetch("https://ipwho.is/");
    ipData = await r.json();

    document.getElementById("ip").textContent = ipData.ip;
    document.getElementById("ipType").textContent = ipData.type;
    document.getElementById("isp").textContent = ipData.connection?.isp || "--";
    document.getElementById("asn").textContent = ipData.connection?.asn || "--";
    document.getElementById("timezone").textContent = ipData.timezone?.id || "--";
}

function loadGPS(){
    navigator.geolocation.getCurrentPosition(async pos=>{
        gpsData.lat = pos.coords.latitude;
        gpsData.lon = pos.coords.longitude;

        const r = await fetch(
          `https://nominatim.openstreetmap.org/reverse?format=json&lat=${gpsData.lat}&lon=${gpsData.lon}`
        );
        const g = await r.json();
        const a = g.address || {};

        gpsData.city = a.city || a.town || a.village || "";
        gpsData.region = a.state || "";
        gpsData.country = a.country || "";

        document.getElementById("city").textContent = gpsData.city || "--";
        document.getElementById("region").textContent = gpsData.region || "--";
        document.getElementById("postal").textContent = a.postcode || "--";
        document.getElementById("country").textContent = gpsData.country || "--";

        compareLocations();
        show();
    },()=>{
        document.getElementById("loader").innerHTML =
        "<p style='color:red'>GPS permission denied</p>";
    },{
        enableHighAccuracy:true,
        timeout:10000
    });
}

function compareLocations(){
    let mismatch = false;

    if(ipData.country && gpsData.country && ipData.country !== gpsData.country){
        mismatch = true;
    }

    if(ipData.latitude && ipData.longitude){
        const dist = getDistance(
            ipData.latitude, ipData.longitude,
            gpsData.lat, gpsData.lon
        );
        if(dist > 100) mismatch = true;
    }

    if(mismatch){
        document.getElementById("alert").style.display = "block";
    }
}

function getDistance(lat1, lon1, lat2, lon2){
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a =
      Math.sin(dLat/2) ** 2 +
      Math.cos(lat1 * Math.PI / 180) *
      Math.cos(lat2 * Math.PI / 180) *
      Math.sin(dLon/2) ** 2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

function show(){
    document.getElementById("loader").classList.add("hidden");
    document.getElementById("content").classList.remove("hidden");
}

loadIP();
loadGPS();
</script>

</body>
</html>